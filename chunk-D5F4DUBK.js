import{a as C}from"./chunk-2FFOQCPS.js";import{a as z,b as j}from"./chunk-BTGBWRQG.js";import{a as re}from"./chunk-CGFSL3JU.js";import{a as V,c as U}from"./chunk-76MIRPDM.js";import{a as ne}from"./chunk-UZW6OXPX.js";import{c as Z}from"./chunk-DFF2A2V2.js";import{a as S}from"./chunk-XE4SEQK7.js";import{a as T,b as Y}from"./chunk-Q75O5SUG.js";import{a as se}from"./chunk-V24KNJUK.js";import{b as E,d as oe,g as te,h as W,r as ie}from"./chunk-MTOQREGE.js";import"./chunk-IZOBXTRQ.js";import{b as w,c as ee}from"./chunk-JEHFEJHR.js";import{a as y}from"./chunk-3LCGF45W.js";import"./chunk-SNTC6ISU.js";import"./chunk-5UOHSEQ7.js";import"./chunk-LGSLEHKQ.js";import{f as Q,g as X,h as g,i as F}from"./chunk-6ZSGU6WM.js";import"./chunk-WJCMRRD3.js";import"./chunk-SYIRRWMM.js";import"./chunk-T3Q3DASN.js";import"./chunk-LLJ4QRQX.js";import"./chunk-EKTMPHIH.js";import"./chunk-E4P4CAIP.js";import{Ba as N,Db as q,Eb as H,Gb as u,J as _,Mb as J,Nb as A,Pb as O,Qb as G,Rb as a,Sb as s,Tb as B,Xb as M,_b as I,ac as f,cb as p,ea as m,lb as c,na as x,oa as k,oc as L,qb as b,qc as K,vc as R,xb as P}from"./chunk-VU6Q4IP4.js";import{a as n,b as r}from"./chunk-TSRGIXR5.js";var ae=new te(n({},ne({label:"Role Name *",placeholder:"Role Name",key:"roleName",class:"input-text-gray mb-1",validators:[E.required,E.maxLength(50)],fieldConfig:{type:oe.Text}}))),v=new W(r(n({},V({label:"Groups (optional)",placeholder:"Select Groups",key:"groups",value:[]})),{class:"input-gray mb-2",fieldConfig:r(n({},U()),{isSearchable:!0,searchConfig:{placeholder:"Groups",noEntriesFound:""},isMultiple:!0,options:c([]),optionsConfig:{labelPath:"groupName",valuePath:"id"},onRemove:t=>console.log("remove",t),onButtonClick:t=>console.log(t),onScroll:t=>console.log("onScroll",t),onSearch:t=>console.log("onSearch",t)}),onChange:t=>console.log("onChange",t)})),d=new W(r(n({},V({label:"Permissions *",placeholder:"Select Permissions",key:"permissions",validators:[E.required]})),{class:"input-gray mb-2",fieldConfig:r(n({},U()),{isSearchable:!0,isDisplayChips:!0,searchConfig:{placeholder:"Permissions",noEntriesFound:""},isMultiple:!0,options:c([]),onRemove:t=>console.log("remove",t),onButtonClick:t=>console.log(t),onScroll:t=>console.log("onScroll",t),onSearch:t=>console.log("onSearch",t)}),onChange:t=>console.log("onChange",t)})),le=r(n({},y({text:"Submit",type:g.Submit})),{className:"btn btn--primary w-30"}),me=r(n({},y({text:"Cancel",color:F.Warn,matType:X.Flat})),{className:"btn btn--light-gray w-30"});var D=class t{#e=m(C);#i=m(z);#n=m(j);#o=S(T);#t=[];#r=0;#s=m(ee);roleId=N(0);role=c({});onTakeAction=N.required();formFields=[ae,v,d];buttons=[me,le];buttonClass="justify-content-start";ngOnInit(){this.initialize(),this.getPermissionGroups(this.#o),this.getPermissions(),this.roleId()&&this.getRoleById()}initialize(){v.fieldConfig.onSearch=e=>this.onSearchGroups(e),d.fieldConfig.onSearch=e=>this.onSearchPermissions(e),v.fieldConfig.onScroll=()=>this.onScrollGroups(),d.fieldConfig.chipsHistory=[]}addNewRole(e,o){this.#e.create(o).pipe(_(()=>e.isLoading=!1)).subscribe(i=>{this.#s.addAlert(n({message:"Role created successfully"},w)),this.onTakeAction()({buttonConfig:e,value:o??{}},()=>{})})}updateRole(e,o){o=r(n({},o),{permissions:[...new Set(o?.permissions?.map(i=>i?.key??i))],id:this.roleId()}),this.#e.update(r(n({},o),{id:this.roleId()})).pipe(_(()=>e.isLoading=!1)).subscribe(i=>{this.#s.addAlert(n({message:"Role updated successfully"},w)),this.onTakeAction()({buttonConfig:e,value:o??{}},()=>{})})}onTakeEvent(e){let{buttonConfig:o,value:i}=e;o.type===g.Submit?(e.buttonConfig.isLoading=!0,this.onSubmit(o,i)):this.onTakeAction()({buttonConfig:o,value:i},()=>{})}onSubmit(e,o){this.roleId()?this.updateRole(e,o):this.addNewRole(e,o)}getPermissions(){this.#i.permissions$.subscribe(e=>d.fieldConfig.options.set(e))}getPermissionGroups(e){this.#o=n({},e),this.#n.getAll(e).subscribe({next:o=>{let i=o.payload.content;this.#t=[...this.#t,...i],v.fieldConfig.options.set(this.#t),this.#r=o.payload.totalElements}})}getRoleById(){this.#e.getRoleById(this.roleId()).subscribe(e=>{d.fieldConfig.chipsHistory=e.permissions,this.role.set(e)})}onSearchPermissions(e){this.#i.permissions$.subscribe(o=>{let i=o.filter(l=>l.valueEn?.toLowerCase().includes(e?.toLowerCase()));d.fieldConfig.options.set(e?.trim()?.length?i:o)})}onSearchGroups(e){this.#t=[];let o={pageable:r(n({},this.#o.pageable),{pageIndex:0}),keyword:e};this.getPermissionGroups(o)}onScrollGroups(){this.#t.length>=this.#r||(this.#o.pageable.pageIndex+=1,this.getPermissionGroups(this.#o))}static \u0275fac=function(o){return new(o||t)};static \u0275cmp=b({type:t,selectors:[["app-add-role"]],inputs:{roleId:[1,"roleId"],onTakeAction:[1,"onTakeAction"]},features:[R([C,z,j])],decls:1,vars:5,consts:[[3,"event","initValue","formFields","buttons","isStickyForm","buttonClass"]],template:function(o,i){o&1&&(a(0,"lib-muk-dynamic-form",0),I("event",function(h){return i.onTakeEvent(h)}),s()),o&2&&u("initValue",i.role())("formFields",i.formFields)("buttons",i.buttons)("isStickyForm",!0)("buttonClass",i.buttonClass)},dependencies:[ie],encapsulation:2})};var pe=r(n({},y({text:"Add New Role",icon:"add",color:F.Warn})),{className:"btn btn--primary-transparent btn--add-user-transparent",onClick:t=>{}});var ue=()=>[import("./chunk-FD6GCQBE.js").then(t=>t.CardItemComponent),se];function fe(t,e){if(t&1){let o=M();a(0,"div",4)(1,"app-card-item",6),I("onClickCard",function(l){x(o);let h=f(2);return k(h.onOpenDialog(l))}),s()()}if(t&2){let o=e.$implicit;p(),u("isRole",!0)("item",o)}}function ge(t,e){t&1&&(a(0,"div",5)(1,"p",7),L(2,"No Roles Found"),s()())}function Ce(t,e){if(t&1){let o=M();a(0,"lib-muk-pagination",8),I("pageIndexChange",function(l){x(o);let h=f(2);return k(h.onPaginatorChange(l))}),s()}if(t&2){let o=f(2);u("config",o.paginationConfig)}}function he(t,e){if(t&1&&(a(0,"div",3),O(1,fe,2,2,"div",4,A,!1,ge,3,0,"div",5),s(),P(4,Ce,1,1,"lib-muk-pagination",2)),t&2){let o=f();p(),G(o.roles()),p(3),J(o.roles().length?4:-1)}}function _e(t,e){t&1&&(a(0,"div",4),B(1,"app-skeleton"),s())}function Ie(t,e){if(t&1&&(a(0,"div",3),O(1,_e,2,0,"div",4,A),s()),t&2){let o=f();p(),G(o.skeletonCount)}}var $=class t{#e=m(Z);#i=m(C);#n=S(T);buttonConfig=pe;roles=c([]);paginationConfig=S(Y);isLoading=c(!1);skeletonCount=new Array(12);constructor(){this.initialize()}ngOnInit(){this.getRoles()}initialize(){this.buttonConfig.onClick=e=>this.onOpenDialog()}onOpenDialog(e){this.openDialog({title:`${e?"Edit":"Add"}  Role`,message:"",content:null,component:D,inputs:e?{roleId:e.id}:{}},{width:"500px",height:"550px"})}openDialog(e,o){let i=this.#e.openDialog(r(n({},e),{inputs:r(n({},e.inputs),{onTakeAction:l=>this.onSendModalTakeEvent(l,i)})}),o)}onSendModalTakeEvent=(e,o)=>{let{buttonConfig:i,value:l}=e;i.type===g.Submit&&this.getRoles(),o.close()};getRoles(){this.isLoading.set(!0),this.#i.getAll(this.#n).pipe(_(()=>this.isLoading.set(!1))).subscribe({next:e=>{let{content:o,totalElements:i}=e.payload;this.roles.set(o),this.paginationConfig.totalItems=i}})}onPaginatorChange(e){this.#n.pageable.pageIndex=e,this.getRoles()}static \u0275fac=function(o){return new(o||t)};static \u0275cmp=b({type:t,selectors:[["app-roles"]],features:[R([C])],decls:9,vars:3,consts:[[1,"flex","items-center","justify-between"],[1,"text-grey-200","text-sm"],[3,"config"],[1,"grid","grid-cols-12","gap-4","mt-4"],[1,"col-span-12","lg:col-span-3"],[1,"col-span-12"],[3,"onClickCard","isRole","item"],[1,"text-grey-200","text-center"],[3,"pageIndexChange","config"]],template:function(o,i){o&1&&(a(0,"section")(1,"div",0)(2,"div",1),L(3),s(),B(4,"lib-muk-button",2),s(),P(5,he,5,2)(6,Ie,3,0),q(7,5,ue,null,6),s()),o&2&&(p(3),K("",i.roles().length," Active Roles"),p(),u("config",i.buttonConfig),p(3),H(!i.isLoading()))},dependencies:[Q,re],encapsulation:2})};export{$ as default};
